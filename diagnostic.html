<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diagnostic - Portfolio Brunet Ethan</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: #f5f5f5;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #202020;
            margin-bottom: 10px;
            border-bottom: 3px solid #EAEAEA;
            padding-bottom: 15px;
        }
        
        .subtitle {
            color: #666;
            margin-bottom: 30px;
        }
        
        .check-section {
            margin: 30px 0;
        }
        
        .check-item {
            display: flex;
            align-items: center;
            padding: 12px;
            margin: 10px 0;
            background: #f9f9f9;
            border-radius: 4px;
            border-left: 4px solid #ddd;
        }
        
        .check-item.success {
            background: #f0f8f4;
            border-left-color: #4caf50;
        }
        
        .check-item.error {
            background: #fef5f5;
            border-left-color: #f44336;
        }
        
        .check-item.warning {
            background: #fffbf0;
            border-left-color: #ff9800;
        }
        
        .icon {
            font-size: 24px;
            margin-right: 15px;
            min-width: 30px;
        }
        
        .icon.success::before { content: "‚úì"; color: #4caf50; font-weight: bold; }
        .icon.error::before { content: "‚úó"; color: #f44336; font-weight: bold; }
        .icon.warning::before { content: "‚ö†"; color: #ff9800; }
        
        .info {
            flex: 1;
        }
        
        .label {
            font-weight: 600;
            color: #333;
            display: block;
        }
        
        .detail {
            font-size: 12px;
            color: #999;
            margin-top: 3px;
            font-family: monospace;
        }
        
        .code {
            background: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            margin: 15px 0;
            font-family: "Courier New", monospace;
            font-size: 13px;
            overflow-x: auto;
        }
        
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #eee;
        }
        
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 14px;
            font-weight: 500;
            color: #666;
            border-bottom: 3px solid transparent;
            margin-bottom: -2px;
            transition: all 0.3s;
        }
        
        .tab.active {
            color: #202020;
            border-bottom-color: #202020;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Diagnostic - Portfolio Brunet Ethan</h1>
        <p class="subtitle">V√©rification de l'int√©grit√© du d√©ploiement statique</p>
        
        <div class="tabs">
            <button class="tab active" onclick="showTab('overview')">Vue d'ensemble</button>
            <button class="tab" onclick="showTab('resources')">Ressources</button>
            <button class="tab" onclick="showTab('tools')">Outils</button>
            <button class="tab" onclick="showTab('logs')">Logs</button>
        </div>
        
        <!-- TAB: Overview -->
        <div id="overview" class="tab-content active">
            <div class="check-section">
                <h2>√âtat du Site</h2>
                <div id="status-checks"></div>
            </div>
            
            <div class="check-section">
                <h2>Informations Syst√®me</h2>
                <div class="check-item">
                    <span class="icon info"></span>
                    <div class="info">
                        <span class="label">Localisation</span>
                        <span class="detail" id="location">-</span>
                    </div>
                </div>
                <div class="check-item">
                    <span class="icon info"></span>
                    <div class="info">
                        <span class="label">User Agent</span>
                        <span class="detail" id="ua" style="word-break: break-all;">-</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- TAB: Resources -->
        <div id="resources" class="tab-content">
            <div class="check-section">
                <h2>V√©rification des Fichiers CSS</h2>
                <div id="css-checks"></div>
            </div>
            
            <div class="check-section">
                <h2>V√©rification des Fichiers JavaScript</h2>
                <div id="js-checks"></div>
            </div>
            
            <div class="check-section">
                <h2>V√©rification des Images</h2>
                <div id="img-checks"></div>
            </div>
        </div>
        
        <!-- TAB: Tools -->
        <div id="tools" class="tab-content">
            <div class="check-section">
                <h2>Outils de Diagnostic</h2>
                
                <h3 style="margin: 20px 0 10px 0;">V√©rifier toutes les ressources</h3>
                <p style="margin-bottom: 10px; color: #666;">Cette fonction va v√©rifier tous les fichiers CSS, JS et images.</p>
                <button onclick="scanAllResources()" style="padding: 10px 20px; background: #202020; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 14px; font-weight: 500;">
                    üîç Lancer la v√©rification compl√®te
                </button>
                
                <h3 style="margin: 20px 0 10px 0;">Tester la connectivit√©</h3>
                <button onclick="testConnectivity()" style="padding: 10px 20px; background: #202020; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 14px; font-weight: 500;">
                    üåê Tester la connexion
                </button>
                
                <h3 style="margin: 20px 0 10px 0;">Afficher le JSON Elementor</h3>
                <button onclick="showElementorConfig()" style="padding: 10px 20px; background: #202020; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 14px; font-weight: 500;">
                    üìã Voir la configuration
                </button>
            </div>
        </div>
        
        <!-- TAB: Logs -->
        <div id="logs" class="tab-content">
            <div class="check-section">
                <h2>Erreurs Console</h2>
                <div id="console-logs" style="background: #1e1e1e; color: #d4d4d4; padding: 15px; border-radius: 4px; font-family: monospace; font-size: 12px; max-height: 300px; overflow-y: auto;">
                    <p style="color: #888;">[En attente d'erreurs...]</p>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Capturer les erreurs console
        const consoleLogs = [];
        const originalError = console.error;
        const originalWarn = console.warn;
        const originalLog = console.log;
        
        console.error = function(...args) {
            consoleLogs.push({ type: 'error', msg: args.join(' ') });
            updateConsoleLogs();
            originalError.apply(console, args);
        };
        
        console.warn = function(...args) {
            consoleLogs.push({ type: 'warn', msg: args.join(' ') });
            updateConsoleLogs();
            originalWarn.apply(console, args);
        };
        
        // Capturer aussi les erreurs non attrap√©es
        window.addEventListener('error', (e) => {
            consoleLogs.push({ type: 'error', msg: e.message });
            updateConsoleLogs();
        });
        
        function updateConsoleLogs() {
            const logsDiv = document.getElementById('console-logs');
            if (consoleLogs.length === 0) {
                logsDiv.innerHTML = '<p style="color: #888;">[Pas d\'erreurs console]</p>';
            } else {
                logsDiv.innerHTML = consoleLogs.map(log => {
                    const color = log.type === 'error' ? '#f48771' : log.type === 'warn' ? '#dcdcaa' : '#d4d4d4';
                    return `<div style="color: ${color};">[${log.type.toUpperCase()}] ${log.msg}</div>`;
                }).join('');
            }
        }
        
        function showTab(tabName) {
            // Cache tous les tabs
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(el => el.classList.remove('active'));
            
            // Affiche le tab s√©lectionn√©
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }
        
        async function checkResource(url) {
            try {
                const response = await fetch(url, { method: 'HEAD' });
                return { url, status: response.status, ok: response.ok };
            } catch (error) {
                return { url, status: 0, ok: false, error: error.message };
            }
        }
        
        async function checkAllResources() {
            const links = document.querySelectorAll('[href*="/wp-content"], [href*="/wp-includes"]');
            const scripts = document.querySelectorAll('[src*="/wp-content"], [src*="/wp-includes"]');
            
            const urls = new Set();
            
            links.forEach(el => {
                if (el.href) urls.add(el.href.split('?')[0]);
            });
            
            scripts.forEach(el => {
                if (el.src) urls.add(el.src.split('?')[0]);
            });
            
            return Promise.all(Array.from(urls).map(checkResource));
        }
        
        async function scanAllResources() {
            const results = await checkAllResources();
            
            const cssChecks = document.getElementById('css-checks');
            const jsChecks = document.getElementById('js-checks');
            
            let cssCount = 0, cssOk = 0, jsCount = 0, jsOk = 0;
            
            results.forEach(result => {
                const html = `
                    <div class="check-item ${result.ok ? 'success' : 'error'}">
                        <span class="icon ${result.ok ? 'success' : 'error'}"></span>
                        <div class="info">
                            <span class="label">${result.status || 'ERREUR'}</span>
                            <span class="detail">${result.url}</span>
                        </div>
                    </div>
                `;
                
                if (result.url.includes('.css')) {
                    cssCount++;
                    if (result.ok) cssOk++;
                    cssChecks.innerHTML += html;
                } else if (result.url.includes('.js')) {
                    jsCount++;
                    if (result.ok) jsOk++;
                    jsChecks.innerHTML += html;
                }
            });
            
            console.log(`CSS: ${cssOk}/${cssCount}, JS: ${jsOk}/${jsCount}`);
        }
        
        async function testConnectivity() {
            const results = await Promise.all([
                checkResource('/'),
                checkResource('/wp-content/'),
                checkResource('/wp-includes/'),
            ]);
            
            console.table(results);
            alert(`Tests compl√©t√©s:\n${results.map(r => `${r.url}: ${r.status}`).join('\n')}`);
        }
        
        function showElementorConfig() {
            const config = window.elementorFrontendConfig;
            console.log('Elementor Config:', config);
            
            if (!config) {
                alert('Configuration Elementor non trouv√©e');
                return;
            }
            
            const pre = document.createElement('pre');
            pre.textContent = JSON.stringify(config, null, 2);
            pre.className = 'code';
            
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0,0,0,0.5);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 10000;
            `;
            
            const content = document.createElement('div');
            content.style.cssText = `
                background: white;
                max-width: 80%;
                max-height: 80%;
                overflow: auto;
                padding: 20px;
                border-radius: 8px;
            `;
            
            content.appendChild(pre);
            modal.appendChild(content);
            
            modal.onclick = (e) => {
                if (e.target === modal) modal.remove();
            };
            
            document.body.appendChild(modal);
        }
        
        // Initialisation
        function init() {
            // Localisation
            document.getElementById('location').textContent = `${window.location.hostname}${window.location.pathname}`;
            
            // User Agent
            document.getElementById('ua').textContent = navigator.userAgent;
            
            // V√©rifications de statut
            const statusChecks = document.getElementById('status-checks');
            
            const checks = [
                {
                    label: 'Page index.html',
                    detail: 'Fichier HTML principal charg√©',
                    ok: true
                },
                {
                    label: '√âl√©ments du DOM',
                    detail: `${document.querySelectorAll('*').length} √©l√©ments d√©tect√©s`,
                    ok: document.querySelectorAll('*').length > 100
                },
                {
                    label: 'Ressources CSS/JS',
                    detail: `${document.querySelectorAll('link[rel="stylesheet"], script[src]').length} ressources charg√©es`,
                    ok: document.querySelectorAll('link[rel="stylesheet"], script[src]').length > 5
                },
                {
                    label: 'Configuration Elementor',
                    detail: window.elementorFrontendConfig ? 'Pr√©sente' : 'Manquante',
                    ok: !!window.elementorFrontendConfig
                }
            ];
            
            checks.forEach(check => {
                const html = `
                    <div class="check-item ${check.ok ? 'success' : 'error'}">
                        <span class="icon ${check.ok ? 'success' : 'error'}"></span>
                        <div class="info">
                            <span class="label">${check.label}</span>
                            <span class="detail">${check.detail}</span>
                        </div>
                    </div>
                `;
                statusChecks.innerHTML += html;
            });
            
            // Auto-v√©rifier les ressources
            setTimeout(() => {
                scanAllResources().catch(e => console.error(e));
            }, 500);
        }
        
        // Lancer l'initialisation au chargement
        window.addEventListener('load', init);
    </script>
</body>
</html>
